<!DOCTYPE html>
<html>
<head>
    <title>Key Yönetimi</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #007bff; color: white; }
        form { margin: 5px 0; display: inline; }
        input, button { padding: 5px; margin: 2px; }
        .message { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .logout { background: #ff3333; color: white; padding: 5px 10px; text-decoration: none; }
        .logout:hover { background: #cc0000; }
        .section { margin-top: 20px; }
        .action-btn { background: #28a745; color: white; border: none; cursor: pointer; }
        .action-btn:hover { background: #218838; }
        .ban-btn { background: #dc3545; color: white; }
        .ban-btn:hover { background: #c82333; }
    </style>
</head>
<body>
    <h1>Key Yönetimi Paneli</h1>
    <a href="{{ url_for('logout') }}" class="logout">Çıkış Yap</a>
    {% if message %}
        <p class="{% if 'Hata' in message %}error{% else %}message{% endif %}">{{ message }}</p>
    {% endif %}

    <!-- Yeni Key Oluşturma -->
    <div class="section">
        <h2>Yeni Key Oluştur</h2>
        <a href="{{ url_for('create_key') }}">Yeni Key Oluştur</a>
    </div>

    <!-- Kullanılmayan Key'ler -->
    <div class="section">
        <h2>Kullanılmayan Key'ler</h2>
        {% if unused_keys %}
            <table>
                <tr><th>Key</th><th>Kullanıcı</th><th>Bitiş Tarihi</th><th>İşlemler</th></tr>
                {% for k in unused_keys %}
                <tr>
                    <td>{{ k['key'] }}</td>
                    <td>{{ k['username'] }}</td>
                    <td>{{ k['end_date'] }}</td>
                    <td>
                        <form method="post" action="{{ url_for('ban_key') }}" style="display:inline;">
                            <input type="hidden" name="key" value="{{ k['key'] }}">
                            <button type="submit" class="ban-btn" onclick="return confirm('Banla?')">Banla</button>
                        </form>
                        <form method="post" action="{{ url_for('unban_key') }}" style="display:inline;">
                            <input type="hidden" name="key" value="{{ k['key'] }}">
                            <button type="submit" class="action-btn" onclick="return confirm('Ban kaldırılsın mı?')">Ban Kaldır</button>
                        </form>
                        <form method="post" style="display:inline;">
                            <input type="hidden" name="action" value="extend">
                            <input type="hidden" name="key" value="{{ k['key'] }}">
                            <input type="number" name="days" value="365" min="1" style="width:50px;">
                            <button type="submit" class="action-btn">Uzat</button>
                        </form>
                        <form method="post" style="display:inline;">
                            <input type="hidden" name="action" value="reduce">
                            <input type="hidden" name="key" value="{{ k['key'] }}">
                            <input type="number" name="days" value="30" min="1" style="width:50px;">
                            <button type="submit" class="action-btn">Düşür</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>Hiç kullanılmayan key yok.</p>
        {% endif %}
    </div>

    <!-- Kullanılan Key'ler -->
    <div class="section">
        <h2>Kullanılan Key'ler</h2>
        {% if used_keys %}
            <table>
                <tr><th>Key</th><th>Kullanıcı</th><th>Bitiş Tarihi</th><th>Kullanım Sayısı</th><th>İşlemler</th></tr>
                {% for k in used_keys %}
                <tr>
                    <td>{{ k['key'] }}</td>
                    <td>{{ k['username'] }}</td>
                    <td>{{ k['end_date'] }}</td>
                    <td>{{ k['usage_count'] }}</td>
                    <td>
                        <form method="post" action="{{ url_for('ban_key') }}" style="display:inline;">
                            <input type="hidden" name="key" value="{{ k['key'] }}">
                            <button type="submit" class="ban-btn" onclick="return confirm('Banla?')">Banla</button>
                        </form>
                        <form method="post" action="{{ url_for('unban_key') }}" style="display:inline;">
                            <input type="hidden" name="key" value="{{ k['key'] }}">
                            <button type="submit" class="action-btn" onclick="return confirm('Ban kaldırılsın mı?')">Ban Kaldır</button>
                        </form>
                        <form method="post" style="display:inline;">
                            <input type="hidden" name="action" value="extend">
                            <input type="hidden" name="key" value="{{ k['key'] }}">
                            <input type="number" name="days" value="365" min="1" style="width:50px;">
                            <button type="submit" class="action-btn">Uzat</button>
                        </form>
                        <form method="post" style="display:inline;">
                            <input type="hidden" name="action" value="reduce">
                            <input type="hidden" name="key" value="{{ k['key'] }}">
                            <input type="number" name="days" value="30" min="1" style="width:50px;">
                            <button type="submit" class="action-btn">Düşür</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>Hiç kullanılan key yok.</p>
        {% endif %}
    </div>

    <!-- Banlı Key'ler -->
    <div class="section">
        <h2>Banlı Key'ler</h2>
        {% if banned_keys %}
            <table>
                <tr><th>Key</th><th>Kullanıcı</th><th>Bitiş Tarihi</th><th>İşlemler</th></tr>
                {% for k in banned_keys %}
                <tr>
                    <td>{{ k['key'] }}</td>
                    <td>{{ k['username'] }}</td>
                    <td>{{ k['end_date'] }}</td>
                    <td>
                        <form method="post" action="{{ url_for('unban_key') }}" style="display:inline;">
                            <input type="hidden" name="key" value="{{ k['key'] }}">
                            <button type="submit" class="action-btn" onclick="return confirm('Ban kaldırılsın mı?')">Ban Kaldır</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>Hiç banlı key yok.</p>
        {% endif %}
    </div>

    <!-- Banlı IP'ler -->
    <div class="section">
        <h2>Banlı IP'ler</h2>
        {% if banned_ips %}
            <table>
                <tr><th>IP</th><th>Ban Tarihi</th><th>Sebep</th><th>İşlemler</th></tr>
                {% for ip in banned_ips %}
                <tr>
                    <td>{{ ip['ip'] }}</td>
                    <td>{{ ip['ban_date'] }}</td>
                    <td>{{ ip['reason'] }}</td>
                    <td>
                        <form method="post" action="{{ url_for('unban_ip') }}" style="display:inline;">
                            <input type="hidden" name="ip" value="{{ ip['ip'] }}">
                            <button type="submit" class="action-btn" onclick="return confirm('Ban kaldırılsın mı?')">Ban Kaldır</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>Hiç banlı IP yok.</p>
        {% endif %}
    </div>
</body>
</html>
